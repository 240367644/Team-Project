<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Basket - Accom4U</title>

    <style>
        body { font-family: Arial; margin: 0; background: #f8f8f8; }
        header, footer { background: #222; color: #fff; padding: 15px; text-align: center; }
        .basket-container { display: flex; margin: 20px; gap: 20px; }
        .basket-items { flex: 2; background: white; padding: 15px; border-radius: 8px; }
        .basket-item { display: flex; gap: 15px; margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #ccc; }
        .basket-item img { width: 100px; height: 100px; object-fit: cover; }
        .item-details { flex: 1; }
        .quantity-control { display: flex; align-items: center; gap: 10px; }
        .quantity-control button { padding: 5px 10px; cursor: pointer; }
        .remove-item { margin-top: 10px; padding: 5px 10px; background: red; color: white; border: none; cursor: pointer; }
        .basket-summary { flex: 1; background: white; padding: 15px; border-radius: 8px; height: fit-content; }
        .summary-line, .summary-total { display: flex; justify-content: space-between; margin: 10px 0; }
        .checkout-btn { display: block; background: green; color: white; padding: 10px; text-align: center; border-radius: 5px; margin-top: 10px; text-decoration: none; }
    </style>
</head>

<body>

<header>
    <h1>Accom4U - Your Basket</h1>
</header>

<main class="basket-container">

    <div class="basket-items"></div>

    <div class="basket-summary">
        <h3>Order Summary</h3>

        <div class="summary-line">
            <span>Subtotal</span>
            <span id="subtotal">£0.00</span>
        </div>

        <div class="summary-line">
            <span>Delivery</span>
            <span>£0.00</span>
        </div>

        <div class="summary-total">
            <span>Total</span>
            <span id="total">£0.00</span>
        </div>

        <a href="#" class="checkout-btn">Proceed to Checkout</a>
    </div>

</main>

<footer>
    © 2025 Accom4U
</footer>

<script>
let basket = []; // will be loaded from backend

/* -------------------------
   Load basket from PHP backend
---------------------------*/
function loadBasket() {
    fetch('basket.php?path=getBasket')
        .then(res => res.json())
        .then(data => {
            if (data.status === "success") {
                basket = Object.values(data.basket); // convert cart object to array
                displayBasket(data.summary);
            } else {
                console.log("Error loading basket:", data.message);
            }
        })
        .catch(err => console.log("Fetch error:", err));
}

/* -------------------------
   Display Basket Contents
---------------------------*/
function displayBasket(summary = null) {
    const container = document.querySelector(".basket-items");
    container.innerHTML = "";

    let subtotal = 0;

    basket.forEach((item, index) => {
        subtotal += item.price * item.quantity;

        container.innerHTML += `
            <div class="basket-item">
                <img src="${item.image || 'images/sample-product.jpg'}" alt="product">

                <div class="item-details">
                    <h3>${item.name}</h3>
                    <p>£${item.price.toFixed(2)}</p>

                    <div class="quantity-control">
                        <button onclick="changeQty(${index}, -1)">-</button>
                        <span>${item.quantity}</span>
                        <button onclick="changeQty(${index}, 1)">+</button>
                    </div>

                    <button class="remove-item" onclick="removeItem(${index})">Remove</button>
                </div>
            </div>
        `;
    });

    if (summary) {
        document.getElementById("subtotal").textContent = "£" + summary.subtotal.toFixed(2);
        document.getElementById("total").textContent = "£" + summary.total.toFixed(2);
    } else {
        document.getElementById("subtotal").textContent = "£" + subtotal.toFixed(2);
        document.getElementById("total").textContent = "£" + subtotal.toFixed(2);
    }
}

/* -------------------------
   Change Quantity
---------------------------*/
function changeQty(index, amount) {
    const item = basket[index];
    const newQty = item.quantity + amount;

    if (newQty <= 0) {
        removeItem(index);
        return;
    }

    fetch('basket.php?path=updateQuantity', {
        method: 'POST',
        headers: {'Content-Type':'application/x-www-form-urlencoded'},
        body: `product_id=${item.id}&quantity=${newQty}`
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") loadBasket();
    });
}

/* -------------------------
   Remove Item
---------------------------*/
function removeItem(index) {
    const item = basket[index];
    fetch('basket.php?path=removeFromCart', {
        method: 'POST',
        headers: {'Content-Type':'application/x-www-form-urlencoded'},
        body: `product_id=${item.id}`
    })
    .then(res => res.json())
    .then(data => {
        if (data.status === "success") loadBasket();
    });
}

/* -------------------------
   Initial load
---------------------------*/
document.addEventListener('DOMContentLoaded', loadBasket);
</script>

</body>
</html>
